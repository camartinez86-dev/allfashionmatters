<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Simple Calendar</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background: #0a0a0f; color: #e0e0e0; min-height: 100vh; padding: 24px; }
        h1 { font-size: 1.8rem; margin-bottom: 24px; color: #6366f1; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: #12121a; border: 1px solid #1a1a2e; border-radius: 12px; padding: 24px; margin-bottom: 20px; }
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 8px; color: #888; font-size: 0.9rem; }
        input, select, textarea { 
            width: 100%; padding: 12px; background: #0a0a0f; border: 1px solid #1a1a2e; 
            border-radius: 8px; color: #e0e0e0; font-size: 1rem;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #6366f1; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.2s; }
        .btn-primary { background: #6366f1; color: white; }
        .btn-primary:hover { background: #4f46e5; }
        .btn-secondary { background: #1a1a2e; color: #e0e0e0; margin-right: 12px; }
        .btn-secondary:hover { background: #252540; }
        .event-item {
            display: flex; align-items: center; gap: 16px; padding: 16px; 
            background: #0a0a0f; border-radius: 10px; margin-bottom: 12px;
        }
        .event-date { 
            background: linear-gradient(135deg, #6366f1, #8b5cf6); 
            padding: 12px; border-radius: 8px; text-align: center; min-width: 60px;
        }
        .event-date .month { font-size: 0.7rem; text-transform: uppercase; }
        .event-date .day { font-size: 1.4rem; font-weight: 700; }
        .event-info { flex: 1; }
        .event-title { font-weight: 600; margin-bottom: 4px; }
        .event-time { font-size: 0.85rem; color: #888; }
        .event-actions button { 
            background: none; border: none; color: #ef4444; cursor: pointer; 
            font-size: 0.9rem; padding: 8px;
        }
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-nav h2 { font-size: 1.4rem; }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 8px; }
        .weekday { text-align: center; font-size: 0.8rem; color: #666; padding: 8px; }
        .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .day { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
            background: #12121a; border-radius: 8px; cursor: pointer; transition: all 0.2s;
        }
        .day:hover { background: #1a1a2e; }
        .day.selected { background: #6366f1; }
        .day.other-month { color: #444; }
        .day.today { border: 2px solid #6366f1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÖ Calendar</h1>
        
        <!-- Mini Calendar View -->
        <div class="card">
            <div class="calendar-nav">
                <button class="btn btn-secondary" onclick="changeMonth(-1)">‚Üê</button>
                <h2 id="currentMonth">February 2026</h2>
                <button class="btn btn-secondary" onclick="changeMonth(1)">‚Üí</button>
            </div>
            <div class="weekdays">
                <div class="weekday">Sun</div><div class="weekday">Mon</div><div class="weekday">Tue</div>
                <div class="weekday">Wed</div><div class="weekday">Thu</div><div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            <div class="days" id="calendarDays"></div>
        </div>
        
        <!-- Add Event Form -->
        <div class="card">
            <h3 style="margin-bottom: 16px;">‚ûï Add Event</h3>
            <form id="eventForm">
                <div class="form-group">
                    <label>Event Title</label>
                    <input type="text" id="eventTitle" placeholder="Doctor appointment, Meeting, etc." required>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="eventDate" required>
                </div>
                <div class="form-group">
                    <label>Time</label>
                    <input type="time" id="eventTime">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="eventDesc" rows="2" placeholder="Optional notes..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Add Event</button>
            </form>
        </div>
        
        <!-- Events List -->
        <div class="card">
            <h3 style="margin-bottom: 16px;">üìã Upcoming Events</h3>
            <div id="eventsList">
                <p style="color: #666;">No events yet. Add one above!</p>
            </div>
        </div>
        
        <!-- Export -->
        <div class="card">
            <h3 style="margin-bottom: 16px;">üîó Google Calendar</h3>
            <p style="color: #888; margin-bottom: 16px;">Export your events to import into Google Calendar:</p>
            <button class="btn btn-primary" onclick="exportICS()">üì§ Export .ics File</button>
            <p style="color: #666; font-size: 0.85rem; margin-top: 12px;">
                Then go to Google Calendar ‚Üí Settings ‚Üí Import & export ‚Üí Upload the .ics file
            </p>
        </div>
    </div>
    
    <script>
        let events = [];
        let currentDate = new Date();
        
        // Load events from file
        async function loadEvents() {
            try {
                const response = await fetch('/calendar/events.json');
                if (response.ok) {
                    events = await response.json();
                }
            } catch (e) {
                console.log('Using local events');
            }
            renderEvents();
        }
        
        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                              'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = 
                monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDay = firstDay.getDay();
            const today = new Date();
            
            let html = '';
            
            // Previous month days
            for (let i = startDay - 1; i >= 0; i--) {
                const d = new Date(currentDate.getFullYear(), currentDate.getMonth(), -i);
                html += `<div class="day other-month">${d.getDate()}</div>`;
            }
            
            // Current month days
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const d = new Date(currentDate.getFullYear(), currentDate.getMonth(), i);
                const isToday = d.toDateString() === today.toDateString();
                html += `<div class="day${isToday ? ' today' : ''}">${i}</div>`;
            }
            
            // Next month days
            const remaining = 42 - startDay - lastDay.getDate();
            for (let i = 1; i <= remaining; i++) {
                html += `<div class="day other-month">${i}</div>`;
            }
            
            document.getElementById('calendarDays').innerHTML = html;
        }
        
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }
        
        function renderEvents() {
            const sorted = events.sort((a, b) => new Date(a.date) - new Date(b.date));
            const container = document.getElementById('eventsList');
            
            if (sorted.length === 0) {
                container.innerHTML = '<p style="color: #666;">No events yet. Add one above!</p>';
                return;
            }
            
            container.innerHTML = sorted.map((e, i) => `
                <div class="event-item">
                    <div class="event-date">
                        <div class="month">${new Date(e.date).toLocaleString('en-US', { month: 'short' })}</div>
                        <div class="day">${new Date(e.date).getDate()}</div>
                    </div>
                    <div class="event-info">
                        <div class="event-title">${e.title}</div>
                        <div class="event-time">${e.time || 'All day'}${e.description ? ' ‚Ä¢ ' + e.description : ''}</div>
                    </div>
                    <div class="event-actions">
                        <button onclick="deleteEvent(${i})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const event = {
                title: document.getElementById('eventTitle').value,
                date: document.getElementById('eventDate').value,
                time: document.getElementById('eventTime').value,
                description: document.getElementById('eventDesc').value
            };
            events.push(event);
            await saveEvents();
            renderEvents();
            e.target.reset();
        });
        
        async function saveEvents() {
            try {
                await fetch('/save-events', {
                    method: 'POST',
                    body: JSON.stringify(events)
                });
            } catch (e) {
                console.log('Could not save to server, using local storage');
                localStorage.setItem('calendarEvents', JSON.stringify(events));
            }
        }
        
        async function deleteEvent(index) {
            events.splice(index, 1);
            await saveEvents();
            renderEvents();
        }
        
        function exportICS() {
            let ics = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Calendar//EN\n`;
            events.forEach(e => {
                const date = e.date.replace(/-/g, '');
                ics += `BEGIN:VEVENT\nDTSTART:${date}${e.time ? 'T' + e.time.replace(':', '') + '00' : ''}\n`;
                ics += `DTEND:${date}${e.time ? 'T' + e.time.replace(':', '') + '00' : ''}\n`;
                ics += `SUMMARY:${e.title}\nDESCRIPTION:${e.description || ''}\nEND:VEVENT\n`;
            });
            ics += 'END:VCALENDAR';
            
            const blob = new Blob([ics], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'calendar-events.ics';
            a.click();
        }
        
        // Set default date to today
        document.getElementById('eventDate').valueAsDate = new Date();
        
        renderCalendar();
        loadEvents();
    </script>
</body>
</html>